@using System.Data
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Activos</title>
    <style>
        /* Estilos para el contenedor de carga */
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #loadingIcon {
            color: white;
            font-size: 2rem;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h4 class="mb-4">Reporte General de Activos</h4>

        <form method="get" asp-action="reporteActivoGeneral" class="mb-4">
            <div class="row gy-2">
                <div class="col-md-5">
                    <label for="status" class="form-label">Estado</label>
                    <select id="status" name="status" class="form-select">
                        <option value="">Todos</option>
                        @if (ViewBag.StatusList != null)
                        {
                            foreach (var status in ViewBag.StatusList)
                            {
                                var isSelected = ViewBag.SelectedStatus != null && ViewBag.SelectedStatus.ToString() == status.ToString();
                                <option value="@status" selected="@(isSelected ? "selected" : null)">@status</option>
                            }
                        }
                    </select>
                </div>

                <div class="col-md-5">
                    <label for="category" class="form-label">Categoría</label>
                    <select id="category" name="category" class="form-select">
                        <option value="">Todas</option>
                        @if (ViewBag.CategoryList != null)
                        {
                            foreach (var category in ViewBag.CategoryList)
                            {
                                var isSelected = ViewBag.SelectedCategory != null && ViewBag.SelectedCategory.ToString() == category.ToString();
                                <option value="@category" selected="@(isSelected ? "selected" : null)">@category</option>
                            }
                        }
                    </select>
                </div>

                <div class="col-md-2 d-flex align-items-end justify-content-start justify-content-md-end mt-2 mt-md-0">
                    <button type="submit" class="btn btn-primary">Filtrar</button>
                </div>
            </div>
        </form>



        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        @foreach (DataColumn col in Model.Columns)
                        {
                            <th>
                                @switch (col.ColumnName)
                                {
                                    case "assetSysId":
                                        @("ID")
                                        break;
                                    case "Status":
                                        @("Estado")
                                        break;
                                    case "Category":
                                        @("Categoría")
                                        break;
                                    case "assetItemNumber":
                                        @("Num Item Activo")
                                        break;
                                    case "assetERP":
                                        @("ERP Activo")
                                        break;
                                    case "Placa":
                                        @("Placa")
                                        break;
                                    case "shortDescription":
                                        @("Descripción Corta")
                                        break;
                                    case "longDescription":
                                        @("Descripción Larga")
                                        break;
                                    case "marca":
                                        @("ID Marca")
                                        break;
                                    case "nombreMarca":
                                        @("Nombre Marca")
                                        break;
                                    case "modelo":
                                        @("ID Modelo")
                                        break;
                                    case "nombreModelo":
                                        @("Nombre Modelo")
                                        break;
                                    case "serialNo":
                                        @("No. Serial")
                                        break;
                                    case "CostColons":
                                        @("Costo Colones")
                                        break;
                                    case "CostDollars":
                                        @("Costo Dólares")
                                        break;
                                    case "LocationA":
                                        @("Ubicación A")
                                        break;
                                    case "LocationB":
                                        @("Ubicación B")
                                        break;
                                    case "LocationC":
                                        @("Ubicación C")
                                        break;
                                    case "LocationD":
                                        @("Ubicación D")
                                        break;
                                    case "EmployeeRelated":
                                        @("Empleado")
                                        break;
                                    case "EPC":
                                        @("EPC")
                                        break;
                                    case "Impuesto":
                                        @("Impuesto")
                                        break;
                                    case "PartNo":
                                        @("No. Part")
                                        break;
                                    case "Depreciado":
                                        @("Depreciado")
                                        break;
                                    case "NumeroFactura":
                                        @("Num Factura")
                                        break;
                                    case "NombrePoliza":
                                        @("Poliza")
                                        break;
                                    case "numeroGarantia":
                                        @("Num Garantía")
                                        break;
                                    case "DiasObsoletoInterna":
                                        @("Día Obsoleto Interna")
                                        break;
                                    case "DiasObsoletoProcomer":
                                        @("Día Obsoleto Procomer")
                                        break;
                                    case "ValorFinalVidaUtil":
                                        @("Vida Útil")
                                        break;
                                    case "FechaCapitalizacion":
                                        @("Fecha Capitalización")
                                        break;
                                    case "CentroCostos":
                                        @("Centro Costos")
                                        break;
                                    case "BarcoreParent":
                                        @("Barcore Padre")
                                        break;
                                    case "DescriptionParent":
                                        @("Descripción Padre")
                                        break;
                                    default:
                                        @col.ColumnName
                                        break;
                                }
                            </th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (DataRow row in Model.Rows)
                    {
                        <tr>
                            @foreach (var item in row.ItemArray)
                            {
                                <td>@item</td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
           


        </div>
    </div>
    <!-- Paginación -->
    <nav aria-label="Page navigation">
        <div class="d-flex flex-column flex-sm-row justify-content-between align-items-center">
            <!-- Información de la página actual -->
            <div class="pagination-info mb-2 mb-sm-0">
                <span>Página @ViewBag.CurrentPage de @ViewBag.TotalPages</span>
            </div>

            <!-- Paginación -->
            <ul class="pagination flex-wrap justify-content-center justify-content-sm-end">
                <!-- Ir a la primera página -->
                @if (ViewBag.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("reporteActivoGeneral", new { status = ViewBag.SelectedStatus, category = ViewBag.SelectedCategory, page = 1 })" aria-label="First">
                            <span aria-hidden="true">&laquo;&laquo;</span>
                        </a>
                    </li>
                }

                <!-- Ir a la página anterior -->
                @if (ViewBag.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("reporteActivoGeneral", new { status = ViewBag.SelectedStatus, category = ViewBag.SelectedCategory, page = ViewBag.CurrentPage - 1 })" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                }

                <!-- Mostrar números de páginas -->
                @for (var i = 1; i <= ViewBag.TotalPages; i++)
                {
                    @if (i == 1 || i == ViewBag.TotalPages || (i >= ViewBag.CurrentPage - 2 && i <= ViewBag.CurrentPage + 2))
                    {
                        <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                            <a class="page-link" href="@Url.Action("reporteActivoGeneral", new { status = ViewBag.SelectedStatus, category = ViewBag.SelectedCategory, page = i })">@i</a>
                        </li>
                    }

                    @if (i == ViewBag.CurrentPage + 2 && ViewBag.CurrentPage + 2 < ViewBag.TotalPages)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }
                }

                <!-- Ir a la página siguiente -->
                @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("reporteActivoGeneral", new { status = ViewBag.SelectedStatus, category = ViewBag.SelectedCategory, page = ViewBag.CurrentPage + 1 })" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                }

                <!-- Ir a la última página -->
                @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("reporteActivoGeneral", new { status = ViewBag.SelectedStatus, category = ViewBag.SelectedCategory, page = ViewBag.TotalPages })" aria-label="Last">
                            <span aria-hidden="true">&raquo;&raquo;</span>
                        </a>
                    </li>
                }
            </ul>
        </div>
    </nav>


    <form id="exportForm" asp-action="ExportarExcel" method="get" style="margin-bottom: 20px; margin-top: 20px;">
        <input type="hidden" id="selectedststus" name="status" value="@ViewBag.Status" />
        <input type="hidden" id="selectedcategory" name="category" value="@ViewBag.Category" />
        <button type="submit" class="btn btn-success">
            <i class="fas fa-file-excel"></i> Exportar a Excel
        </button>
    </form>
    <script>
        document.getElementById('exportForm').addEventListener('submit', function() {
            // Capturar los valores seleccionados
            var selectedCompany = document.getElementById('status').value;
            var selectedBuilding = document.getElementById('category').value;

            // Asignar los valores a los campos ocultos
            document.getElementById('selectedststus').value = selectedCompany;
            document.getElementById('selectedcategory').value = selectedBuilding;
           
        });
    </script>

    <!-- Contenedor de carga -->
    <div id="loadingOverlay">
        <div id="loadingIcon">
            <i class="fas fa-spinner fa-spin"></i> Cargando...
        </div>
    </div>

    <script>
        // document.getElementById('exportForm').addEventListener('submit', function() {
        //     // Mostrar el ícono de carga
        //     document.getElementById('loadingOverlay').style.display = 'flex';
        // });

        // Ocultar el ícono de carga cuando la página se recarga o se redirige
        window.addEventListener('load', function() {
            document.getElementById('loadingOverlay').style.display = 'none';
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.table').DataTable();
        });
    </script>
</body>
</html>
